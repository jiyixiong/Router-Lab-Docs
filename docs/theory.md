# 理论复习

在做实验前，让我们复习一下网络原理课上讲到的理论，理解一下为什么要实现一个 RIP 协议的路由器，实现的时候我们需要考虑哪些东西。

## 网络的功能

网络的功能是什么？让两个主机相隔万里也可以通信。如果要用现实生活来比喻，那么就像是全球的快递，可以把货物送到任何一个人的手上。寄过快递或者网购的同学应该都知道，寄件的时候，需要往快递单上写下一个全球唯一的寄件人地址和收件人地址，快递员按照收件人地址，一步一步转运到目的地。

那么，假如你是快递公司，你会如何计划路线，让一个快件从寄件人发送到收件人？如果我们观察现实生活中快递的路径，经常可以看到这样的流程：

寄件人->寄件人最近的快递站->寄件人所在区->寄件人所在市->寄件人所在省->收件人所在省->收件人所在市->收件人所在区->收件人最近的快递站->收件人

从中间划开，我们可以看到，快件先从小地方不断转到大地方，再从大地方转到小地方，最后到达终点。每一次转运，都是两种情况：要么是同级转运，比如上面的“寄件人所在省->收件人所在省”，要么是级间转运，比如上面的“寄件人所在区->寄件人所在市”等等。

上面是从全局视角来规划这个事情，但假如，你是某某快递北京市转运中心的员工，对于手上的快递，你要怎么决定，这个快递是给中国转运中心（上一级），还是给天津转运中心（同一级），还是给海淀区转运中心（下一级）呢？

答案是根据收件人的地址进行判断：

1. 首先看收件人是不是北京市的，如果是，那就看是哪个区的，如果是海淀区的，就转到海淀区转运中心（下一级）
2. 如果不是北京的，那就看是不是中国其他省市的，如果是天津市的，那就转到天津市转运中心（同一级）
3. 如果不是中国的，那肯定是到国外的，那就转到中国转运中心，之后再转到国外。

如果每一级快递转运中心都按照这样的逻辑判断，那就不需要一个全局的人来调度了，只需要各转运中心按照自己的逻辑，找到下一家，把快递送到下一家即可。

把上面的这个故事挪到虚拟的网络世界，那么寄件人收件人的地址就是全球可达的 IP 地址，快递转运中心就是各级路由器，转运中心用来判断下一家转运中心的机制就是查路由表。

那么，为了让网络联通，只需要让所有路由器都配置好正确的路由表。但这件事情并不简单，网络中会经常出现变化，总不能让每个路由器旁边都蹲一个人，实时修改配置吧。所以我们需要一个路由协议，让路由器自己找到正确的路由表。

## RIP 协议的用途

为了让路由器找到正确的路由表，本实验要实现的就是一个简单的路由协议：RIP 协议。简单来说，假如现在要搭建这样一个快递网络：

清华大学 <-> 海淀区 <-> 西城区 <-> 东城区 <-> 故宫

其中海淀区是清华大学的上级，东城区是故宫的上级，海淀区、西城区和东城区平级。海淀区和西城区接壤，西城区和东城区接壤，但是海淀区和东城区不接壤。

那么，我要从清华大学访问故宫的网站，怎么办？第一步很简单，清华大学知道故宫不在海淀区，那么肯定转给自己的上级海淀区。但是海淀区也不知道故宫在哪，海淀区只知道自己和西城区接壤。这时候就需要运行 RIP 协议，让海淀区知道，如果要访问故宫，那就转给西城区。

形象地来说，RIP 协议运行过程如下：

1. 海淀区宣传我这里有清华大学，东城区宣传我这里有故宫
2. 宣传的声音传播距离很短，只有接壤的才能听得到，所以西城区知道海淀区有清华大学，东城区有故宫
3. 然后西城区给东城区宣传，虽然我没有清华大学，但是我可以帮你找到清华大学；西城区给海淀区宣传，虽然我没有故宫，但是我知道故宫怎么走
4. 这时候海淀区知道有故宫这么一个地方，并且去故宫，要先去西城区；东城区知道有清华大学这么一个地方，并且去清华大学，要先去西城区
5. 这时候清华大学和故宫之间的网络就联通了

这就是我们接下来实验里要做的。